# Alpha éŸ§æ€§ç³»ç»Ÿ - ç”¨æˆ·æŒ‡å—

**ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-01-31

---

## ç›®å½•

1. [ç®€ä»‹](#ç®€ä»‹)
2. [æ ¸å¿ƒèƒ½åŠ›](#æ ¸å¿ƒèƒ½åŠ›)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [é…ç½®é€‰é¡¹](#é…ç½®é€‰é¡¹)
5. [é«˜çº§ç‰¹æ€§](#é«˜çº§ç‰¹æ€§)
6. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
7. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ç®€ä»‹

Alphaçš„**"æ°¸ä¸æ”¾å¼ƒ"éŸ§æ€§ç³»ç»Ÿ**ç¡®ä¿æ‚¨çš„ä»»åŠ¡å³ä½¿åœ¨é‡åˆ°æ•…éšœã€ç½‘ç»œé—®é¢˜æˆ–æœåŠ¡ä¸­æ–­æ—¶ä¹Ÿèƒ½æˆåŠŸå®Œæˆã€‚å®ƒå®ç°äº†æ™ºèƒ½é‡è¯•ç­–ç•¥ã€è‡ªåŠ¨æ›¿ä»£æ–¹æ¡ˆæ¢ç´¢ã€å¤±è´¥æ¨¡å¼åˆ†æå’Œåˆ›é€ æ€§é—®é¢˜è§£å†³ã€‚

### æ ¸å¿ƒåŸåˆ™

> **å½“æ–¹æ³•å¤±è´¥æ—¶ï¼ŒAlphaè‡ªåŠ¨åˆ‡æ¢ç­–ç•¥ã€å¹¶è¡Œæ¢ç´¢å¤šä¸ªè§£å†³æ–¹æ¡ˆè·¯å¾„ã€åˆ†æå¤±è´¥ä»¥é¿å…é‡å¤ã€è®¾è®¡åˆ›é€ æ€§å˜é€šæ–¹æ¡ˆï¼Œå¹¶é€šè¿‡æ™ºèƒ½è¿­ä»£æŒç»­å°è¯•ç›´åˆ°æˆåŠŸæˆ–æ‰€æœ‰é€‰é¡¹è€—å°½ã€‚**

---

## æ ¸å¿ƒèƒ½åŠ›

### 1. æ™ºèƒ½é‡è¯•ä¸ç†”æ–­å™¨

- æŒ‡æ•°é€€é¿åŠ æŠ–åŠ¨ï¼Œé¿å…å‹å®å¤±è´¥çš„æœåŠ¡
- é‡å¤å¤±è´¥åç†”æ–­å™¨æ‰“å¼€ï¼Œå¿«é€Ÿå¤±è´¥è€Œä¸æµªè´¹æ—¶é—´
- è‡ªåŠ¨æ¢å¤æ£€æµ‹ï¼ˆåŠå¼€çŠ¶æ€ï¼‰

### 2. æ›¿ä»£ç­–ç•¥æ¢ç´¢

- ä¸»è¦æ–¹æ³•å¤±è´¥æ—¶è‡ªåŠ¨å‘ç°æ›¿ä»£æ–¹æ¡ˆ
- æ ¹æ®å†å²æˆåŠŸç‡ã€æˆæœ¬å’Œé€Ÿåº¦å¯¹æ›¿ä»£æ–¹æ¡ˆæ’åº
- æ”¯æŒé¡ºåºå’Œå¹¶è¡Œæ‰§è¡Œ

### 3. å¤±è´¥æ¨¡å¼åˆ†æ

- æ£€æµ‹5ç§å¤±è´¥æ¨¡å¼ï¼šé‡å¤ã€çº§è”ã€é—´æ­‡ã€æ°¸ä¹…ã€ä¸ç¨³å®šæœåŠ¡
- è¯†åˆ«æ ¹æœ¬åŸå› å¹¶ç”Ÿæˆå¯æ“ä½œå»ºè®®
- **æ–°åŠŸèƒ½**: è·¨é‡å¯æŒä¹…åŒ–å­˜å‚¨ï¼Œå®ç°è·¨ä¼šè¯å­¦ä¹ 

### 4. ç­–ç•¥é»‘åå•

- **æ–°åŠŸèƒ½**: è‡ªåŠ¨å°†é‡å¤å¤±è´¥çš„ç­–ç•¥åˆ—å…¥é»‘åå•
- é¿å…åœ¨å·²çŸ¥å¤±è´¥çš„æ–¹æ³•ä¸Šæµªè´¹æ—¶é—´
- é»‘åå•åœ¨åº”ç”¨é‡å¯åæŒä¹…åŒ–

### 5. åˆ›é€ æ€§é—®é¢˜è§£å†³

- LLMé©±åŠ¨çš„æ–°é¢–å˜é€šæ–¹æ¡ˆç”Ÿæˆ
- å½“æ ‡å‡†å·¥å…·ä¸è¶³æ—¶ç”Ÿæˆè‡ªå®šä¹‰ä»£ç 
- æ‰§è¡Œå‰å®‰å…¨éªŒè¯

### 6. å¹¶è¡Œæ‰§è¡Œ

- åŒæ—¶è¿è¡Œå¤šä¸ªç­–ç•¥ï¼ˆç«é€Ÿæ¨¡å¼ï¼‰
- ç¬¬ä¸€ä¸ªæˆåŠŸçš„è·èƒœï¼Œå…¶ä»–è‡ªåŠ¨å–æ¶ˆ
- æˆåŠŸæ—¶é—´å‡å°‘30-50%

---

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç”¨æ³•

```python
from alpha.core.resilience import ResilienceEngine, ResilienceConfig

# åˆ›å»ºéŸ§æ€§å¼•æ“
config = ResilienceConfig(
    max_attempts=5,
    enable_alternatives=True,
    enable_persistence=True  # å¯ç”¨è·¨é‡å¯å­¦ä¹ 
)

engine = ResilienceEngine(config)

# ä½¿ç”¨éŸ§æ€§æ‰§è¡Œ
async def my_task():
    # æ‚¨çš„ä»£ç 
    return await fetch_data_from_api()

result = await engine.execute(
    my_task,
    operation_name="fetch_api_data"
)

if result.success:
    print(f"âœ… æˆåŠŸ: {result.value}")
else:
    print(f"âŒ å¤±è´¥: {result.error}")
    print(f"ğŸ“Š å»ºè®®: {result.recommendations}")
```

### ä½¿ç”¨æ›¿ä»£ç­–ç•¥

```python
from alpha.core.resilience import Strategy

# å®šä¹‰æ›¿ä»£ç­–ç•¥
strategies = [
    Strategy(
        name="primary_provider",
        func=fetch_from_provider_a,
        priority=1.0,
        description="ä¸»è¦APIæä¾›å•†"
    ),
    Strategy(
        name="backup_provider",
        func=fetch_from_provider_b,
        priority=0.8,
        description="å¤‡ä»½APIæä¾›å•†"
    ),
    Strategy(
        name="cache_fallback",
        func=fetch_from_cache,
        priority=0.5,
        description="ç¼“å­˜æ•°æ®å›é€€"
    )
]

# ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆæ‰§è¡Œï¼ˆå¹¶è¡Œæ¨¡å¼ï¼‰
result = await engine.execute_with_alternatives(
    strategies,
    operation_name="fetch_weather_data",
    parallel=True  # åŒæ—¶å°è¯•æ‰€æœ‰ï¼Œç¬¬ä¸€ä¸ªæˆåŠŸçš„è·èƒœ
)
```

---

## é…ç½®é€‰é¡¹

### ResilienceConfig é…ç½®é¡¹

```python
from alpha.core.resilience import ResilienceConfig

config = ResilienceConfig(
    # é‡è¯•é…ç½®
    max_attempts=5,              # æ¯ä¸ªç­–ç•¥çš„æœ€å¤§é‡è¯•æ¬¡æ•°
    base_delay=1.0,              # åˆå§‹é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰
    max_delay=60.0,              # æœ€å¤§é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰
    backoff_factor=2.0,          # æŒ‡æ•°é€€é¿ä¹˜æ•°

    # èµ„æºé™åˆ¶
    max_total_time=300.0,        # æ€»æ—¶é—´é¢„ç®—ï¼ˆ5åˆ†é’Ÿï¼‰
    max_api_cost=1.0,            # APIæˆæœ¬é™åˆ¶ï¼ˆ$1ï¼‰
    max_total_attempts=20,       # æ‰€æœ‰ç­–ç•¥çš„æ€»å°è¯•æ¬¡æ•°

    # æ›¿ä»£æ–¹æ¡ˆæ¢ç´¢
    max_parallel_strategies=3,   # æœ€å¤§å¹¶å‘ç­–ç•¥æ•°
    strategy_timeout=30.0,       # æ¯ä¸ªç­–ç•¥çš„è¶…æ—¶ï¼ˆç§’ï¼‰
    enable_alternatives=True,    # å¯ç”¨è‡ªåŠ¨æ›¿ä»£å‘ç°
    enable_creative_solving=True, # å¯ç”¨LLMé©±åŠ¨çš„åˆ›é€ æ€§è§£å†³

    # å¤±è´¥åˆ†æ
    pattern_detection_threshold=3,  # æ£€æµ‹æ¨¡å¼æ‰€éœ€çš„å¤±è´¥æ¬¡æ•°
    enable_learning=True,        # å¯ç”¨å¤±è´¥å­¦ä¹ 
    enable_persistence=True,     # **æ–°**: å¯ç”¨SQLiteæŒä¹…åŒ–

    # è¿›åº¦è·Ÿè¸ª
    enable_progress_tracking=True,
    checkpoint_interval=60.0,    # æ£€æŸ¥ç‚¹é¢‘ç‡ï¼ˆç§’ï¼‰
)
```

### å¯ç”¨æŒä¹…åŒ–å¤±è´¥å­¦ä¹ 

**v1.0æ–°åŠŸèƒ½**: ä½¿ç”¨SQLiteæŒä¹…åŒ–å¯ç”¨è·¨é‡å¯å¤±è´¥å­¦ä¹ ï¼š

```python
from alpha.core.resilience import FailureAnalyzer

# å¯ç”¨æŒä¹…åŒ–ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
analyzer = FailureAnalyzer(
    pattern_threshold=3,
    enable_persistence=True,
    db_path="data/failures.db"  # æ•°æ®åº“æ–‡ä»¶è·¯å¾„
)
```

**ä¼˜åŠ¿**:
- åº”ç”¨é‡å¯åè®°ä½å¤±è´¥
- ç­–ç•¥é»‘åå•æŒä¹…åŒ–
- 30å¤©è‡ªåŠ¨ä¿ç•™
- å¤±è´¥è¶‹åŠ¿åˆ†æ

---

## é«˜çº§ç‰¹æ€§

### 1. å¤±è´¥æ¨¡å¼æ£€æµ‹

Alphaæ£€æµ‹5ç§å¤±è´¥æ¨¡å¼ï¼š

| æ¨¡å¼ | æè¿° | è‡ªåŠ¨æ“ä½œ |
|------|------|---------|
| **REPEATING** | ç›¸åŒé”™è¯¯å¤šæ¬¡å‡ºç° | å°è¯•æ›¿ä»£æ–¹æ³• |
| **CASCADING** | åŒä¸€æ“ä½œçš„ä¸åŒé”™è¯¯ | æ£€æŸ¥ä¾èµ–é¡¹ |
| **INTERMITTENT** | æˆåŠŸå’Œå¤±è´¥äº¤æ›¿ | å®ç°ç†”æ–­å™¨ |
| **PERMANENT** | æŒç»­å¤±è´¥ | é‡æ–°æ€è€ƒç­–ç•¥ |
| **UNSTABLE_SERVICE** | åŒä¸€æœåŠ¡çš„å¤šç§é”™è¯¯ç±»å‹ | ä½¿ç”¨å›é€€æä¾›å•† |

### 2. ç­–ç•¥é»‘åå•ï¼ˆæ–°åŠŸèƒ½ï¼‰

è‡ªåŠ¨æˆ–æ‰‹åŠ¨å°†å¤±è´¥ç­–ç•¥åˆ—å…¥é»‘åå•ï¼š

```python
# æ£€æŸ¥ç­–ç•¥æ˜¯å¦åœ¨é»‘åå•ä¸­
if analyzer.is_strategy_blacklisted("provider_x", "fetch_data"):
    print("ç­–ç•¥åœ¨é»‘åå•ä¸­ï¼Œè·³è¿‡")

# æ‰‹åŠ¨å°†ç­–ç•¥åˆ—å…¥é»‘åå•
analyzer.add_to_blacklist(
    strategy_name="failing_provider",
    operation="api_call",
    reason="é‡å¤è¶…æ—¶é”™è¯¯ï¼ˆ10åˆ†é’Ÿå†…5æ¬¡å¤±è´¥ï¼‰"
)

# æŸ¥çœ‹æ‰€æœ‰é»‘åå•ç­–ç•¥
blacklist = analyzer.get_blacklist()
for entry in blacklist:
    print(f"{entry['strategy_name']}: {entry['failure_count']} æ¬¡å¤±è´¥")

# ä»é»‘åå•ä¸­ç§»é™¤ï¼ˆé—®é¢˜ä¿®å¤åï¼‰
analyzer.remove_from_blacklist("provider_x", "api_call")
```

### 3. å¤±è´¥åˆ†æï¼ˆæ–°åŠŸèƒ½ï¼‰

è·å–å¤±è´¥è¶‹åŠ¿æ´å¯Ÿï¼š

```python
analytics = analyzer.get_analytics()

print(f"æ€»å¤±è´¥æ¬¡æ•°: {analytics['total_failures']}")
print(f"é»‘åå•ç­–ç•¥: {analytics['blacklisted_strategies']}")

print("\næœ€å¸¸è§é”™è¯¯:")
for error in analytics['most_common_errors']:
    print(f"  {error['error_type']}: {error['count']} æ¬¡")

print("\né—®é¢˜æ“ä½œ:")
for op in analytics['problematic_operations']:
    print(f"  {op['operation']}: {op['failure_count']} æ¬¡å¤±è´¥")
```

### 4. è‡ªåŠ¨æ¸…ç†

é…ç½®è‡ªåŠ¨æ¸…ç†æ—§å¤±è´¥è®°å½•ï¼š

```python
# æ¸…ç†30å¤©å‰çš„å¤±è´¥è®°å½•
deleted_count = analyzer.cleanup_old_failures(days=30)
print(f"åˆ é™¤äº† {deleted_count} æ¡æ—§å¤±è´¥è®°å½•")
```

**å»ºè®®**: é€šè¿‡cronä»»åŠ¡æˆ–è®¡åˆ’ä»»åŠ¡æ¯å‘¨è¿è¡Œæ¸…ç†ã€‚

### 5. å¹¶è¡Œ vs é¡ºåºæ‰§è¡Œ

**é¡ºåº**ï¼ˆé»˜è®¤ï¼‰:
- æŒ‰ä¼˜å…ˆçº§é¡ºåºé€ä¸ªå°è¯•ç­–ç•¥
- è¾ƒä½çš„èµ„æºä½¿ç”¨
- å¯é¢„æµ‹çš„æˆæœ¬

```python
result = await engine.execute_with_alternatives(
    strategies,
    parallel=False
)
```

**å¹¶è¡Œ**ï¼ˆç«é€Ÿæ¨¡å¼ï¼‰:
- åŒæ—¶å°è¯•å¤šä¸ªç­–ç•¥
- ç¬¬ä¸€ä¸ªæˆåŠŸçš„è·èƒœï¼Œå…¶ä»–å–æ¶ˆ
- æ›´å¿«çš„æˆåŠŸæ—¶é—´ï¼ˆå‡å°‘30-50%ï¼‰
- è¾ƒé«˜çš„èµ„æºä½¿ç”¨

```python
result = await engine.execute_with_alternatives(
    strategies,
    parallel=True
)
```

**ä½•æ—¶ä½¿ç”¨å¹¶è¡Œ**:
- æ—¶é—´å…³é”®çš„æ“ä½œ
- é«˜ä»·å€¼ä»»åŠ¡
- ç­–ç•¥æˆæœ¬ç›¸ä¼¼
- æœ‰å¤šä¸ªä½å»¶è¿Ÿæ›¿ä»£æ–¹æ¡ˆå¯ç”¨

---

## æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒå¯ç”¨æŒä¹…åŒ–

```python
# âœ… ç”Ÿäº§ç¯å¢ƒæ¨è
config = ResilienceConfig(enable_persistence=True)
```

**ä¼˜åŠ¿**:
- è·¨é‡å¯ä»è¿‡å»çš„å¤±è´¥ä¸­å­¦ä¹ 
- é¿å…é‡å¤å¤±è´¥çš„ç­–ç•¥
- ç”¨äºæ•…éšœæ’æŸ¥çš„åˆ†æ

### 2. è®¾ç½®é€‚å½“çš„èµ„æºé™åˆ¶

```python
config = ResilienceConfig(
    max_total_time=300.0,  # å¤§å¤šæ•°ä»»åŠ¡5åˆ†é’Ÿ
    max_api_cost=1.0,      # $1æˆæœ¬é™åˆ¶ï¼ˆæ ¹æ®ä»»åŠ¡ä»·å€¼è°ƒæ•´ï¼‰
    max_total_attempts=20  # é˜²æ­¢æ— é™å¾ªç¯
)
```

### 3. å®šä¹‰æ¸…æ™°çš„æ“ä½œåç§°

```python
# âœ… å¥½: å…·ä½“ã€æœ‰æ„ä¹‰çš„åç§°
await engine.execute(task, operation_name="fetch_user_profile_from_db")

# âŒ ä¸å¥½: é€šç”¨åç§°
await engine.execute(task, operation_name="fetch_data")
```

**åŸå› **: æ“ä½œåç§°ç”¨äºå¤±è´¥åˆ†ç»„ã€åˆ†æå’Œé»‘åå•ã€‚

### 4. ä¸ºå¤±è´¥æä¾›ä¸Šä¸‹æ–‡

```python
await engine.execute(
    task,
    operation_name="api_call",
    context={
        "endpoint": "/users/123",
        "method": "GET",
        "provider": "service_a"
    }
)
```

**åŸå› **: ä¸Šä¸‹æ–‡æœ‰åŠ©äºè¯†åˆ«æ ¹æœ¬åŸå› å¹¶ç”Ÿæˆæ›´å¥½çš„å»ºè®®ã€‚

### 5. å®šæœŸç»´æŠ¤

```python
# æ¯å‘¨æ¸…ç†ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡cronä»»åŠ¡ï¼‰
analyzer.cleanup_old_failures(days=30)

# æ¯æœˆå®¡æŸ¥é»‘åå•
blacklist = analyzer.get_blacklist()
# å¦‚æœæä¾›å•†å·²ä¿®å¤ï¼Œå®¡æŸ¥å¹¶åˆ é™¤æ¡ç›®
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜: å¤±è´¥æœªæŒä¹…åŒ–

**ç—‡çŠ¶**: é‡å¯åå¤±è´¥æœªè¢«è®°ä½

**è§£å†³æ–¹æ¡ˆ**:
```python
# ç¡®ä¿å¯ç”¨äº†æŒä¹…åŒ–
analyzer = FailureAnalyzer(enable_persistence=True)

# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
import os
assert os.path.exists("data/failures.db")
```

### é—®é¢˜: é»‘åå•ä¸èµ·ä½œç”¨

**ç—‡çŠ¶**: é»‘åå•ä¸­çš„ç­–ç•¥ä»åœ¨å°è¯•

**è§£å†³æ–¹æ¡ˆ**:
```python
# éªŒè¯é»‘åå•æ¡ç›®å­˜åœ¨
blacklist = analyzer.get_blacklist()
print(blacklist)

# æ£€æŸ¥æ“ä½œåç§°å®Œå…¨åŒ¹é…
# æ“ä½œåç§°åŒºåˆ†å¤§å°å†™
```

### é—®é¢˜: æ•°æ®åº“å¢é•¿è¿‡å¤§

**ç—‡çŠ¶**: `failures.db` æ–‡ä»¶ > 100MB

**è§£å†³æ–¹æ¡ˆ**:
```python
# å‡å°‘ä¿ç•™æœŸ
analyzer.cleanup_old_failures(days=14)  # åªä¿ç•™2å‘¨

# æˆ–æ¸…é™¤æ‰€æœ‰ï¼ˆæ³¨æ„ï¼šä¸¢å¤±å­¦ä¹ æ•°æ®ï¼‰
analyzer.store.clear_all()
```

---

## ç¤ºä¾‹

### ç¤ºä¾‹1: ç®€å•çš„éŸ§æ€§APIè°ƒç”¨

```python
from alpha.core.resilience import ResilienceEngine, ResilienceConfig
import httpx

config = ResilienceConfig(max_attempts=5)
engine = ResilienceEngine(config)

async def fetch_user_data(user_id):
    async with httpx.AsyncClient() as client:
        response = await client.get(f"https://api.example.com/users/{user_id}")
        response.raise_for_status()
        return response.json()

result = await engine.execute(
    fetch_user_data,
    user_id=123,
    operation_name="fetch_user_data"
)

if result.success:
    user = result.value
    print(f"ç”¨æˆ·: {user['name']}")
```

### ç¤ºä¾‹2: å¤šæä¾›å•†å›é€€

```python
from alpha.core.resilience import Strategy

strategies = [
    Strategy("primary", fetch_from_primary, priority=1.0),
    Strategy("secondary", fetch_from_secondary, priority=0.8),
    Strategy("cache", fetch_from_cache, priority=0.3)
]

result = await engine.execute_with_alternatives(
    strategies,
    operation_name="fetch_critical_data",
    parallel=True  # åŒæ—¶å°è¯•æ‰€æœ‰
)
```

### ç¤ºä¾‹3: å¤±è´¥åˆ†æä»ªè¡¨æ¿

```python
def print_failure_dashboard(analyzer):
    analytics = analyzer.get_analytics()

    print("=" * 50)
    print("å¤±è´¥åˆ†æä»ªè¡¨æ¿")
    print("=" * 50)

    print(f"\nğŸ“Š æ€»ä½“ç»Ÿè®¡:")
    print(f"  æ€»å¤±è´¥æ¬¡æ•°: {analytics['total_failures']}")
    print(f"  é»‘åå•ç­–ç•¥: {analytics['blacklisted_strategies']}")

    print(f"\nğŸš« æœ€å¸¸è§é”™è¯¯:")
    for i, error in enumerate(analytics['most_common_errors'][:5], 1):
        print(f"  {i}. {error['error_type']}: {error['count']} æ¬¡")

    print(f"\nâš ï¸  é—®é¢˜æ“ä½œ:")
    for i, op in enumerate(analytics['problematic_operations'][:5], 1):
        print(f"  {i}. {op['operation']}: {op['failure_count']} æ¬¡å¤±è´¥")

    print("\n" + "=" * 50)

# æ¯å‘¨è¿è¡Œ
print_failure_dashboard(analyzer)
```

---

**æ›´å¤šä¿¡æ¯**:
- [æŠ€æœ¯æ¶æ„](../../docs/internal/resilience_system_design.md)
- [APIæ–‡æ¡£](../../docs/internal/code_execution_api.md)

---

**ç‰ˆæœ¬å†å²**:
- v1.0 (2026-01-31): æ·»åŠ SQLiteæŒä¹…åŒ–ã€ç­–ç•¥é»‘åå•ã€åˆ†æåŠŸèƒ½
- v0.9 (2026-01-30): åˆå§‹å‘å¸ƒï¼ŒåŒ…å«é‡è¯•ã€æ›¿ä»£æ–¹æ¡ˆã€åˆ›é€ æ€§è§£å†³
